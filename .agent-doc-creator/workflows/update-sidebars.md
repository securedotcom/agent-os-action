# Update Sidebars Workflow

This workflow ensures all generated documentation is properly registered in Docusaurus sidebars.

## Prerequisites

- Documentation files generated
- Docusaurus configured
- `sidebars.js` exists

## Workflow Steps

### 1. Load Current Sidebar Configuration

Read `sidebars.js` (or `.ts`, `.cjs`, `.mjs`)

Parse current structure:
- Existing categories
- Existing items
- Custom configurations

### 2. Scan Generated Documentation

Find all markdown files in `docs/`:
```bash
find docs/ -name "*.md" -o -name "*.mdx"
```

Extract from each file:
- File path relative to `docs/`
- Frontmatter (title, sidebar_position, sidebar_label)
- Document ID

### 3. Group by Category

Organize docs into categories:
- **Introduction**: `intro.md`
- **Architecture**: `architecture/**`
- **ADRs**: `adrs/**`
- **RFCs**: `rfcs/**`
- **Runbooks**: `playbooks/**`
- **ML & Models**: `ml/**`
- **References**: `references/**`

### 4. Build Sidebar Structure

For each category:

**If category exists**:
- Preserve existing structure
- Add new items
- Avoid duplicates
- Respect manual ordering

**If category missing**:
- Create new category
- Add all items
- Use logical ordering

### 5. Order Items

Within each category:

**Use `sidebar_position` from frontmatter**:
- Sort by position if specified
- Fallback to alphabetical

**Special cases**:
- `intro.md` always first
- `overview.md` first in category
- `README.md` first in subcategory

### 6. Handle Subcategories

For nested structures:

**Architecture**:
```javascript
{
  type: 'category',
  label: 'Architecture',
  items: [
    'architecture/overview',
    'architecture/api-service',
    'architecture/auth-service',
  ],
}
```

**ML with nested models**:
```javascript
{
  type: 'category',
  label: 'ML & Models',
  items: [
    'ml/overview',
    {
      type: 'category',
      label: 'Models',
      items: [
        'ml/models/model-1',
        'ml/models/model-2',
      ],
    },
    'ml/datasets',
  ],
}
```

### 7. Preserve Manual Customizations

**Don't remove**:
- Manually added items
- Custom labels
- Custom icons
- Custom links
- Collapsed states

**Preserve**:
- Comments in sidebar file
- Custom configurations
- External links

### 8. Generate Updated Sidebar

Create new sidebar configuration:

```javascript
/** @type {import('@docusaurus/plugin-content-docs').SidebarsConfig} */
const sidebars = {
  docs: [
    'intro',
    {
      type: 'category',
      label: 'Architecture',
      items: [
        'architecture/overview',
        'architecture/api-service',
        'architecture/auth-service',
      ],
      collapsed: false,
    },
    {
      type: 'category',
      label: 'ADRs',
      items: [
        'adrs/README',
        'adrs/0001-use-postgresql',
        'adrs/0002-use-express',
      ],
      collapsed: false,
    },
    // ... more categories
  ],
};

module.exports = sidebars;
```

### 9. Validate Sidebar

Check for:
- Valid JavaScript/TypeScript syntax
- All referenced files exist
- No duplicate IDs
- No circular references

### 10. Write Updated Sidebar

**Backup current**:
```bash
cp sidebars.js sidebars.js.backup
```

**Write new version**:
- Preserve formatting
- Maintain comments
- Use consistent style

### 11. Test Build

```bash
npm run docs:build
```

Check for:
- Sidebar errors
- Missing documents
- Broken links

## Output

- Updated `sidebars.js` (or `.ts`, `.cjs`, `.mjs`)
- Backup of previous sidebar
- Build validation results

## Sidebar Best Practices

1. **Logical grouping**: Group related docs
2. **Clear labels**: Use descriptive category names
3. **Consistent ordering**: Use sidebar_position
4. **Not too deep**: Limit nesting to 2-3 levels
5. **Collapsed by default**: For large categories

## Error Handling

- **Syntax error in sidebar**: Restore from backup
- **Missing referenced file**: Remove from sidebar, log warning
- **Duplicate IDs**: Rename one, update sidebar
- **Build fails**: Investigate error, fix sidebar

## Autogeneration Option

For directories with many files, use autogenerated:

```javascript
{
  type: 'category',
  label: 'ADRs',
  items: [
    'adrs/README',
    {
      type: 'autogenerated',
      dirName: 'adrs',
    },
  ],
}
```

## Next Steps

After successful sidebar update:
1. Verify docs are accessible
2. Test navigation
3. Proceed to create documentation PR

