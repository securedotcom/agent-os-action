name: Lint Code

on:
  pull_request:
    branches: [main, develop, master]
  push:
    branches: [main, develop, master]

permissions:
  contents: read

jobs:
  ruff:
    name: Ruff Linting
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5  # v4.3.1
      
      - name: Set up Python
        uses: actions/setup-python@e797f83bcb11b83ae66e0230d6156d7c80228e7c  # v6.0.0
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: Install ruff
        run: pip install ruff
      
      - name: Run ruff check
        run: |
          echo "ðŸ” Running ruff linter..."
          ruff check . --output-format=github
      
      - name: Run ruff format check
        run: |
          echo "ðŸ“ Checking code formatting..."
          ruff format --check .
      
      - name: Create summary
        if: always()
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          ## ðŸ” Ruff Linting Results
          
          Ruff combines the functionality of:
          - **Black** (code formatting)
          - **isort** (import sorting)
          - **Pylint** (code quality)
          - **Flake8** (style guide)
          - And 50+ other Python linters
          
          **Speed:** ~10-100x faster than Black + Pylint combined
          **Written in:** Rust ðŸ¦€
          
          ### Checks Performed
          - âœ… Code style (PEP 8)
          - âœ… Import sorting
          - âœ… Code quality
          - âœ… Formatting consistency
          - âœ… Common bugs and anti-patterns
          
          EOF

  mypy:
    name: Type Checking
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5  # v4.3.1
      
      - name: Set up Python
        uses: actions/setup-python@e797f83bcb11b83ae66e0230d6156d7c80228e7c  # v6.0.0
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: Install dependencies
        run: |
          pip install mypy types-requests
          pip install -r requirements.txt
      
      - name: Run mypy
        run: |
          echo "ðŸ” Running mypy type checker..."
          mypy scripts/ --ignore-missing-imports || true
        continue-on-error: true
      
      - name: Create summary
        if: always()
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          ## ðŸ” Type Checking Results
          
          MyPy performs static type analysis to catch type-related bugs.
          
          **Note:** Type checking is currently advisory (does not fail build).
          EOF
